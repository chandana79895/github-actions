name: Java CI with Maven

on:
  push:
    branches:
      - "devsecops-check"

jobs:
  deploys:
    runs-on: ubuntu-latest
    environment:
      name: poc

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Docker
        uses: docker/setup-buildx-action@v2

      - name: Run OWASP Dependency-Check
        uses: docker://owasp/dependency-check
        env:
          NVD_API_KEY: ${{ secrets.NVD_API_KEY }} 
        with:
          args: --project "github-actions" --out /results --scan /github/workspace --nvdApiKey=${{ secrets.NVD_API_KEY }}

      - name: Upload Dependency-Check report
        uses: actions/upload-artifact@v3
        with:
          name: dependency-check-report
          path: /results/dependency-check-report.html

      # Uncomment and adjust these steps if needed
      # - name: Set up JDK 11
      #   uses: actions/setup-java@v2
      #   with:
      #     java-version: '11'
      #     distribution: 'adopt'
      #     cache: 'maven'

      # - name: Set up Maven and dependencies
      #   run: |
      #     sudo apt-get update
      #     sudo apt-get install -y maven libasound2 libasound2-data libnspr4 libnss3 default-jre-headless libjansi-java libmaven3-core-java libwagon-file-java libwagon-http-shaded-java xvfb

      # - name: Googledriver setup
      #   run: |
      #     sudo apt install wget -y
      #     sudo apt install unzip -y
      #     wget https://dl.google.com/linux/deb/pool/main/g/google-chrome-stable/google-chrome-stable_126.0.6478.126-1_amd64.deb
      #     sudo dpkg -i google-chrome-stable_126.0.6478.126-1_amd64.deb
      #     wget https://storage.googleapis.com/chrome-for-testing-public/126.0.6478.126/linux64/chromedriver-linux64.zip
      #     unzip chromedriver-linux64.zip  
      #     sudo mv chromedriver-linux64/chromedriver /usr/bin/chromedriver
      #     sudo chown runner:runner /usr/bin/chromedriver
      #     sudo chmod +x /usr/bin/chromedriver

      # - name: Install Firefox and GeckoDriver
      #   run: |
      #     sudo apt-get install -y firefox
      #     GECKO_DRIVER_VERSION=$(curl -s https://api.github.com/repos/mozilla/geckodriver/releases/latest | jq -r '.tag_name')
      #     wget -q "https://github.com/mozilla/geckodriver/releases/download/${GECKO_DRIVER_VERSION}/geckodriver-${GECKO_DRIVER_VERSION}-linux64.tar.gz"
      #     tar -xzf geckodriver-${GECKO_DRIVER_VERSION}-linux64.tar.gz
      #     sudo mv geckodriver /usr/local/bin/geckodriver
      #     sudo chown runner:runner /usr/local/bin/geckodriver
      #     sudo chmod +x /usr/local/bin/geckodriver

      # - name: Start xvfb
      #   run: |
      #     export DISPLAY=:99
      #     cd automation-testing/
      #     xvfb-run -a mvn clean install

      # - name: Upload test report artifact
      #   uses: actions/upload-artifact@v4
      #   with:
      #     name: TestReport
      #     path: automation-testing/reports/index.html
      #     if-no-files-found: warn 

      # - name: Start Docker
      #   run: |
      #     pwd
      #     cd ../../..
      #     pwd
      #     sudo docker exec -it d0f8b04fc07e /bin/bash -c "cd /home/ubuntu/actions-runner && ls -l"
